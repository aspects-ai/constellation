# ConstellationFS Remote Backend Service
# Docker Compose configuration for easy deployment

services:
  remote-backend:
    build:
      context: ..
      dockerfile: remote/Dockerfile.runtime
    image: constellationfs/remote-backend:latest
    container_name: constellation-remote-backend
    ports:
      - "2222:22"  # SSH port mapping
    volumes:
      - ./workspace:/workspace  # Persistent workspace
      # - ./keys:/keys:ro        # SSH keys (uncomment if needed)
    environment:
      # Multi-user configuration (comma-separated)
      - SSH_USERS=dev:devpassword,admin:adminpassword
      
      # Workspace configuration
      - WORKSPACE_ROOT=/workspace
      - ENABLE_LOGGING=true
      
      # SSH key configuration (optional)
      # - SSH_PUBLIC_KEY=ssh-rsa AAAAB3N...your-key-here
    
    restart: unless-stopped
    
    # Health check
    healthcheck:
      test: ["CMD", "service", "ssh", "status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

# Optional: Create a development network
networks:
  constellation:
    driver: bridge

# Optional: Named volume for workspace persistence
volumes:
  workspace:
    driver: local